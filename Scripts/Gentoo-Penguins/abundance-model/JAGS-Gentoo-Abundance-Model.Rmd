---
title: "Gentoo Model Parameter Abundance Model"
author: "Michael J. Wethington"
date: "2024-06-04"
output: html_document
---


zi = latent nest abundance (mean-adjusted)

lz = logged abundance (re-expression of above):  lzi,t=log(zi,t). for the ith site in the tth year,

ri = intrinsic growth rate

lp = predicted population growth rate multiplier
la = actual population growth rate multiplier 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```





```{r}

# Load required libraries
library(tidyverse)
library(coda)
library(mapppdr)
library(patchwork)
library(leaflet)
library(CCAMLRGIS)
library(rjags)
library(MCMCvis)
library(parallel)
library(stringi)
library(pander)
library(testthat)

# Define parameters
min_season <- 1970
max_season <- 2023
species <- "GEPE"

# Construct Presence-Absence Assumptions CSV for the JAGS model
penguin_obs <- mapppdr::penguin_obs

penguin_obs_processed <- penguin_obs %>%
  filter(species_id == species) %>%
  mutate(
    presence = ifelse(!is.na(count), 1, 0),
    known_w = 1) %>%
  select(site_id, season, presence, known_w, count, accuracy, type)

presence_absence_assumptions <- expand.grid(
  site_id = unique(penguin_obs$site_id),
  season = min_season:max_season
) %>%
  left_join(penguin_obs_processed, by = c("site_id", "season")) %>%
  mutate(
    presence = ifelse(is.na(presence), 0, presence),
    known_w = ifelse(is.na(known_w), 0, known_w),
    count = ifelse(is.na(count), 0, count)) %>%
  group_by(site_id, season) %>%
  arrange(desc(type), desc(accuracy), .by_group = TRUE) %>%
  slice(1) %>%
  ungroup() %>%
  select(site_id, season, presence, known_w, count, accuracy)

# Load the JAGS MCMC Output File
load("D:/Manuscripts_localData/FrostBound_AQ/Results/gentoo-abundance-model/model_data_rinits_output.rda")

# Extract the Gentoo Abundance Estimates (lz)
model_samples <- as.matrix(model_data_rinits_output)

# Filter columns that are logged latent abundance (lz) parameters
lz_columns <- grep("^lz\\[", colnames(model_samples))
lz_samples <- model_samples[, lz_columns]

# Convert log-abundances to actual abundances
abundance_samples <- exp(lz_samples)

# Summarize the actual abundances
abundance_summary <- apply(abundance_samples, 2, function(x) {
  c(mean = mean(x), median = median(x), 
    lower_95 = quantile(x, 0.025), upper_95 = quantile(x, 0.975))
})

# Convert to a readable data frame (use t to transpose)
abundance_summary_df <- as.data.frame(t(abundance_summary))

# Extract site and season info from the indices
extract_indices <- function(colname) {
  indices <- gsub("[^0-9,]", "", colname)
  as.integer(unlist(strsplit(indices, ",")))
}

indices <- lapply(colnames(abundance_samples), extract_indices)
sites <- sapply(indices, `[`, 1)
seasons <- sapply(indices, `[`, 2)

abundance_summary_df$site <- sites
abundance_summary_df$season <- seasons

abundance_summary_df <- abundance_summary_df %>% 
  rename(mean_abundance = mean,
         median_abundance = median,
         lower_95_abundance = "lower_95.2.5%",
         upper_95_abundance = "upper_95.97.5%")

head(abundance_summary_df)

# Load and prepare SiteList
SiteList <- mapppdr::penguin_obs %>%
  filter(count > 0 & species_id == species & season >= min_season & season <= max_season) %>%
  mutate(season_relative = season - min_season + 1) %>%
  group_by(site_id) %>%
  summarise(initial_season = min(season_relative)) %>%
  ungroup() %>%
  left_join(mapppdr::sites, by = "site_id") %>%
  mutate(site = as.numeric(as.factor(site_id))) %>%
  select(site_id, site_name, ccamlr_id, site, initial_season, latitude, longitude)

(n_sites <- nrow(SiteList))

SiteList %>% 
  distinct(site, site_id, latitude, longitude)

# Join SiteList with abundance_summary_df
final_data <- left_join(SiteList, abundance_summary_df, by = "site")

# Ensure final_data is sorted by site and season
final_data <- final_data %>%
  arrange(site, season)

# Calculate the growth rate and append it to the data
final_data <- final_data %>%
  group_by(site) %>%
  mutate(growth_rate = mean_abundance / lag(mean_abundance)) %>%
  ungroup()

# Adjust the season column in the final data
final_data <- final_data %>%
  mutate(year = 1970 + season - 1)

# Display the adjusted final_data
print(head(final_data))

write.csv(final_data, "D:/Manuscripts_localData/FrostBound_AQ/Results/gentoo-abundance-model/modeled_gentoo_parameters.csv")
# Print the head of the final data with growth rates
print(head(final_data))

```


```{r}
library(ggplot2)
library(dplyr)

# Calculate geometric mean of growth rates
final_data <- final_data %>%
  group_by(site) %>%
  mutate(geometric_mean_growth_rate = exp(mean(log(growth_rate), na.rm = TRUE))) %>%
  ungroup()

# Filter data for the specific site
site_data <- final_data %>% filter(site_id == "AITC")

# Calculate the mean growth multiplier for the site
mean_growth <- site_data %>% 
  summarize(mean_growth_multiplier = exp(mean(log(growth_rate), na.rm = TRUE)),
            lower_ci = exp(mean(log(growth_rate), na.rm = TRUE) - 1.96 * sd(log(growth_rate), na.rm = TRUE)/sqrt(n())),
            upper_ci = exp(mean(log(growth_rate), na.rm = TRUE) + 1.96 * sd(log(growth_rate), na.rm = TRUE)/sqrt(n())))

# Check if the 'count' and 'type' columns exist and correct them if needed
if (!"count" %in% names(site_data)) {
  site_data$count <- site_data$mean_abundance # or any other logic that fits
}

if (!"type" %in% names(site_data)) {
  site_data$type <- "nests" # default type, adjust as necessary
}

# Add year column based on season
site_data <- site_data %>%
  mutate(year = 1970 + season - 1)

# Generate the plot
ggplot(site_data, aes(x = year, y = mean_abundance)) +
  geom_boxplot(aes(group = year), fill = "orange", alpha = 0.6) +
  geom_errorbar(aes(ymin = lower_95_abundance, ymax = upper_95_abundance), width = 0.2) +
  geom_point(data = site_data %>% filter(!is.na(count)), aes(y = count, color = type), size = 3, shape = 21, fill = "blue") +
  scale_color_manual(values = c("nests" = "red", "chicks" = "blue")) +
  labs(title = "AITC, Barrientos Island (Aitcho Islands), 48.1",
       subtitle = paste0("mean population growth multiplier = ", round(mean_growth$mean_growth_multiplier, 3), 
                         " (", round(mean_growth$lower_ci, 2), " - ", round(mean_growth$upper_ci, 2), ")"),
       x = "Year",
       y = "Abundance",
       color = "Type") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))


```
**Gentoo - SIC Trend Analysis**

```{r}
library(tidyverse)
library(terra)
library(lubridate)
library(nlme)

# Load penguin census data and final modeled abundance data
penguin_data <- read.csv("D:/Manuscripts_localData/FrostBound_AQ/Datasets/mapppd/gentoo_presence_absence_assumptions.csv")
penguin_abundance_data <- read.csv("D:/Manuscripts_localData/FrostBound_AQ/Results/gentoo-abundance-model/modeled_gentoo_parameters.csv")

# Load the sea ice concentration data
nsidc_metrics <- readRDS("D:/Manuscripts_localData/FrostBound_AQ/Datasets/25km_Sea-Ice-Index/analysis/NSIDC_25km_Daily_Metrics.rds")

# Adjust the season column in the penguin abundance data
penguin_abundance_data <- penguin_abundance_data %>%
  mutate(year = 1970 + season - 1)

# Filter penguin data to keep only consecutively censused sites and clean duplicates
consecutively_censused <- penguin_data %>%
  arrange(site_id, season) %>%
  group_by(site_id) %>%
  mutate(next_season = lead(season),
         next_presence = lead(presence)) %>%
  filter(presence == 1 & next_presence == 1 & season != next_season) %>%
  ungroup() %>%
  select(site_id, season, presence, known_w, next_season)

# Merge with penguin abundance data
penguin_abundance_filtered <- penguin_abundance_data %>%
  left_join(consecutively_censused, by = c("site_id" = "site_id", "year" = "season")) %>%
  filter(!is.na(next_season))

# Function to calculate mean sea ice concentration for the overwinter period
calculate_overwinter_sea_ice <- function(years, nsidc_metrics) {
  # Define the winter months (e.g., June to August)
  winter_months <- c(6, 7, 8)
  # Filter sea ice data for the winter months of the given years
  winter_data <- nsidc_metrics %>%
    filter(Year %in% years & Month %in% winter_months)
  # Calculate the mean sea ice concentration over the given years
  mean_sea_ice <- mean(winter_data$MeanSIC, na.rm = TRUE)
  return(mean_sea_ice)
}

# Add previous season's sea ice concentration to the penguin abundance data
penguin_abundance_filtered <- penguin_abundance_filtered %>%
  rowwise() %>%
  mutate(overwinter_sea_ice_1yr = calculate_overwinter_sea_ice(year - 1, nsidc_metrics),
         overwinter_sea_ice_2yr = calculate_overwinter_sea_ice(c(year - 1, year - 2), nsidc_metrics),
         overwinter_sea_ice_3yr = calculate_overwinter_sea_ice(c(year - 1, year - 2, year - 3), nsidc_metrics)) %>%
  ungroup() %>%
  filter(!is.na(overwinter_sea_ice_1yr) & !is.na(overwinter_sea_ice_2yr) & !is.na(overwinter_sea_ice_3yr))

# Fit GLS models for the relationship between sea ice concentration and growth rates across all sites for each time lag

# Previous 1 year
gls_model_1yr <- gls(growth_rate ~ overwinter_sea_ice_1yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Previous 2 years
gls_model_2yr <- gls(growth_rate ~ overwinter_sea_ice_2yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Previous 3 years
gls_model_3yr <- gls(growth_rate ~ overwinter_sea_ice_3yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Summarize the results
summary(gls_model_1yr)
summary(gls_model_2yr)
summary(gls_model_3yr)


```

**Gentoo Sea Ice Persistence Analysis**

Multi-Year Lag Effects
```{r}

# Load the necessary libraries
library(terra)
library(sf)
library(dplyr)
library(ggplot2)
library(lubridate)
library(nlme)

# Load Gentoo penguin data
penguin_data <- read.csv("D:/Manuscripts_localData/FrostBound_AQ/Datasets/mapppd/gentoo_presence_absence_assumptions.csv")
penguin_abundance_data <- read.csv("D:/Manuscripts_localData/FrostBound_AQ/Results/gentoo-abundance-model/modeled_gentoo_parameters.csv")

# Load study area shapefile
study_area_path <- "D:/Manuscripts_localData/FrostBound_AQ/Datasets/gis-layers/study-area/shp/subregions/Frostbound_AQ_Subregions_EPSG_3976.shp"
study_area <- st_read(study_area_path)

# Load the combined buffers shapefile
combined_buffers_sf <- st_read("D:/Manuscripts_localData/FrostBound_AQ/Datasets/mapppd/gentoo_home-ranges/GEPG_homerange_300km.shp")

# Dissolve all buffers into a single home range
dissolved_buffer <- st_union(combined_buffers_sf)

# Load the NSIDC sea ice concentration data
nsidc <- rast("D:/Manuscripts_localData/FrostBound_AQ/Datasets/25km_Sea-Ice-Index/stack/NSIDC_25km_Study-Area.nc")

# Filter the sea ice data from 1980 to 2022
start_date <- as.Date("1980-01-01")
end_date <- as.Date("2022-12-31")
nsidc <- subset(nsidc, which(time(nsidc) >= start_date & time(nsidc) <= end_date))

# Mask the sea ice data with the dissolved buffer
buffer_mask <- mask(nsidc, vect(dissolved_buffer))

# Extract all years for processing
all_years <- unique(year(time(buffer_mask)))

# Define winter months (June-September)
winter_months <- c(6, 7, 8, 9)

# Define a function to count days with ice cover > 15% for each year
count_ice_days <- function(x) {
  ice_days <- sum(x > 15, na.rm = TRUE)
  return(ice_days)
}

# Initialize an empty list to store the annual ice day count rasters
annual_ice_days <- list()

# Loop over each year, subset the raster stack, and apply the counting function
for (year in all_years) {
  year_rasters <- subset(buffer_mask, which(year(time(buffer_mask)) == year & month(time(buffer_mask)) %in% winter_months))
  if (nlyr(year_rasters) > 0) {
    # Apply count_ice_days function across layers (days) at each pixel
    ice_days_raster <- app(year_rasters, count_ice_days)  # app inherently operates cell-wise
    names(ice_days_raster) <- paste("Ice_Days", year, sep="_")
    annual_ice_days[[as.character(year)]] <- ice_days_raster
    print(paste("Processed year:", year))
  } else {
    print(paste("No data for year:", year))
  }
}

# Combine the annual rasters into a single stack
annual_ice_days_stack <- rast(annual_ice_days)

# Calculate the proportion of open water days in winter for each year
calculate_open_water_days <- function(annual_ice_days_stack, years) {
  open_water_days <- sapply(years, function(y) {
    ice_days_raster <- subset(annual_ice_days_stack, names(annual_ice_days_stack) == as.character(y))
    open_water_prop <- global(ice_days_raster, fun = function(x) mean(x < 15, na.rm = TRUE))
    return(open_water_prop)
  })
  return(open_water_days)
}

open_water_days <- calculate_open_water_days(annual_ice_days_stack, all_years)

# Convert the open water days to a data frame for analysis
open_water_df <- data.frame(year = all_years, open_water_prop = unlist(open_water_days))

# Adjust the season column in the penguin abundance data
penguin_abundance_data <- penguin_abundance_data %>%
  mutate(year = 1970 + season - 1)

# Filter penguin data to keep only consecutively censused sites and clean duplicates
consecutively_censused <- penguin_data %>%
  arrange(site_id, season) %>%
  group_by(site_id) %>%
  mutate(next_season = lead(season),
         next_presence = lead(presence)) %>%
  filter(presence == 1 & next_presence == 1 & season != next_season) %>%
  ungroup() %>%
  select(site_id, season, presence, known_w, next_season)

# Merge with penguin abundance data
penguin_abundance_filtered <- penguin_abundance_data %>%
  left_join(consecutively_censused, by = c("site_id" = "site_id", "year" = "season")) %>%
  filter(!is.na(next_season))

# Merge with open water proportion data
penguin_abundance_filtered <- penguin_abundance_filtered %>%
  left_join(open_water_df, by = "year")

# Function to calculate mean sea ice persistence for the overwinter period
calculate_overwinter_sea_ice <- function(year, open_water_df, lag) {
  lag_years <- year - lag
  mean_sea_ice <- open_water_df %>%
    filter(year %in% lag_years) %>%
    summarise(mean(open_water_prop, na.rm = TRUE)) %>%
    pull()
  return(mean_sea_ice)
}

# Add previous season's sea ice persistence to the penguin abundance data
penguin_abundance_filtered <- penguin_abundance_filtered %>%
  rowwise() %>%
  mutate(overwinter_sea_ice_1yr = calculate_overwinter_sea_ice(year, open_water_df, 1),
         overwinter_sea_ice_2yr = calculate_overwinter_sea_ice(year, open_water_df, 1:2),
         overwinter_sea_ice_3yr = calculate_overwinter_sea_ice(year, open_water_df, 1:3)) %>%
  ungroup() %>%
  filter(!is.na(overwinter_sea_ice_1yr) & !is.na(overwinter_sea_ice_2yr) & !is.na(overwinter_sea_ice_3yr))

# Fit GLS models for the relationship between sea ice persistence and growth rates across all sites for each time lag

# Previous 1 year
gls_model_1yr <- gls(growth_rate ~ overwinter_sea_ice_1yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Previous 2 years
gls_model_2yr <- gls(growth_rate ~ overwinter_sea_ice_2yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Previous 3 years
gls_model_3yr <- gls(growth_rate ~ overwinter_sea_ice_3yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Summarize the results
summary(gls_model_1yr)
summary(gls_model_2yr)
summary(gls_model_3yr)

# Visualize the relationships
ggplot(penguin_abundance_filtered, aes(x = overwinter_sea_ice_1yr, y = growth_rate)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  theme_minimal() +
  labs(title = "Relationship Between Sea Ice Persistence (Lag 1 Year) and Penguin Growth Rates",
       x = "Proportion of Open Water Days (Lag 1 Year)",
       y = "Growth Rate")

ggplot(penguin_abundance_filtered, aes(x = overwinter_sea_ice_2yr, y = growth_rate)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  theme_minimal() +
  labs(title = "Relationship Between Sea Ice Persistence (Lag 2 Years) and Penguin Growth Rates",
       x = "Proportion of Open Water Days (Lag 2 Years)",
       y = "Growth Rate")

ggplot(penguin_abundance_filtered, aes(x = overwinter_sea_ice_3yr, y = growth_rate)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  theme_minimal() +
  labs(title = "Relationship Between Sea Ice Persistence (Lag 3 Years) and Penguin Growth Rates",
       x = "Proportion of Open Water Days (Lag 3 Years)",
       y = "Growth Rate")




```


**Single-year Lag Ice Persistence**

```{r}
# Load necessary libraries
library(terra)
library(sf)
library(dplyr)
library(ggplot2)
library(lubridate)
library(nlme)

# Load Gentoo penguin data
penguin_data <- read.csv("D:/Manuscripts_localData/FrostBound_AQ/Datasets/mapppd/gentoo_presence_absence_assumptions.csv")
penguin_abundance_data <- read.csv("D:/Manuscripts_localData/FrostBound_AQ/Results/gentoo-abundance-model/modeled_gentoo_parameters.csv")

# Load study area shapefile
study_area_path <- "D:/Manuscripts_localData/FrostBound_AQ/Datasets/gis-layers/study-area/shp/subregions/Frostbound_AQ_Subregions_EPSG_3976.shp"
study_area <- st_read(study_area_path)

# Load the combined buffers shapefile
combined_buffers_sf <- st_read("D:/Manuscripts_localData/FrostBound_AQ/Datasets/mapppd/gentoo_home-ranges/GEPG_homerange_300km.shp")

# Dissolve all buffers into a single home range
dissolved_buffer <- st_union(combined_buffers_sf)

# Load the NSIDC sea ice concentration data
nsidc <- rast("D:/Manuscripts_localData/FrostBound_AQ/Datasets/25km_Sea-Ice-Index/stack/NSIDC_25km_Study-Area.nc")

# Filter the sea ice data from 1980 to 2022
start_date <- as.Date("1980-01-01")
end_date <- as.Date("2022-12-31")
nsidc <- subset(nsidc, which(time(nsidc) >= start_date & time(nsidc) <= end_date))

# Mask the sea ice data with the dissolved buffer
buffer_mask <- mask(nsidc, vect(dissolved_buffer))

# Extract all years for processing
all_years <- unique(year(time(buffer_mask)))

# Define winter months (June-September)
winter_months <- c(6, 7, 8, 9)

# Define a function to count days with ice cover > 15% for each year
count_ice_days <- function(x) {
  ice_days <- sum(x > 15, na.rm = TRUE)
  return(ice_days)
}

# Initialize an empty list to store the annual ice day count rasters
annual_ice_days <- list()

# Loop over each year, subset the raster stack, and apply the counting function
for (year in all_years) {
  year_rasters <- subset(buffer_mask, which(year(time(buffer_mask)) == year & month(time(buffer_mask)) %in% winter_months))
  if (nlyr(year_rasters) > 0) {
    # Apply count_ice_days function across layers (days) at each pixel
    ice_days_raster <- app(year_rasters, count_ice_days)  # app inherently operates cell-wise
    names(ice_days_raster) <- paste("Ice_Days", year, sep="_")
    annual_ice_days[[as.character(year)]] <- ice_days_raster
    print(paste("Processed year:", year))
  } else {
    print(paste("No data for year:", year))
  }
}

# Combine the annual rasters into a single stack
annual_ice_days_stack <- rast(annual_ice_days)

# Calculate the proportion of open water days in winter for each year
calculate_open_water_days <- function(annual_ice_days_stack, years) {
  open_water_days <- sapply(years, function(y) {
    ice_days_raster <- subset(annual_ice_days_stack, names(annual_ice_days_stack) == as.character(y))
    open_water_prop <- global(ice_days_raster, fun = function(x) mean(x < 15, na.rm = TRUE))
    return(open_water_prop)
  })
  return(open_water_days)
}

open_water_days <- calculate_open_water_days(annual_ice_days_stack, all_years)

# Convert the open water days to a data frame for analysis
open_water_df <- data.frame(year = all_years, open_water_prop = unlist(open_water_days))

# Adjust the season column in the penguin abundance data
penguin_abundance_data <- penguin_abundance_data %>%
  mutate(year = 1970 + season - 1)

# Filter penguin data to keep only consecutively censused sites and clean duplicates
consecutively_censused <- penguin_data %>%
  arrange(site_id, season) %>%
  group_by(site_id) %>%
  mutate(next_season = lead(season),
         next_presence = lead(presence)) %>%
  filter(presence == 1 & next_presence == 1 & season != next_season) %>%
  ungroup() %>%
  select(site_id, season, presence, known_w, next_season)

# Merge with penguin abundance data
penguin_abundance_filtered <- penguin_abundance_data %>%
  left_join(consecutively_censused, by = c("site_id" = "site_id", "year" = "season")) %>%
  filter(!is.na(next_season))

# Merge with open water proportion data
penguin_abundance_filtered <- penguin_abundance_filtered %>%
  left_join(open_water_df, by = "year")

# Function to calculate mean sea ice persistence for the overwinter period
calculate_overwinter_sea_ice <- function(year, open_water_df, lag) {
  lag_year <- year - lag
  mean_sea_ice <- open_water_df %>%
    filter(year == lag_year) %>%
    summarise(mean(open_water_prop, na.rm = TRUE)) %>%
    pull()
  return(mean_sea_ice)
}

# Add previous season's sea ice persistence to the penguin abundance data
penguin_abundance_filtered <- penguin_abundance_filtered %>%
  rowwise() %>%
  mutate(overwinter_sea_ice_1yr = calculate_overwinter_sea_ice(year, open_water_df, 1),
         overwinter_sea_ice_2yr = calculate_overwinter_sea_ice(year, open_water_df, 2),
         overwinter_sea_ice_3yr = calculate_overwinter_sea_ice(year, open_water_df, 3)) %>%
  ungroup() %>%
  filter(!is.na(overwinter_sea_ice_1yr) & !is.na(overwinter_sea_ice_2yr) & !is.na(overwinter_sea_ice_3yr))

# Fit GLS models for the relationship between sea ice persistence and growth rates across all sites for each time lag

# Previous 1 year
gls_model_1yr <- gls(growth_rate ~ overwinter_sea_ice_1yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Previous 2 years
gls_model_2yr <- gls(growth_rate ~ overwinter_sea_ice_2yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Previous 3 years
gls_model_3yr <- gls(growth_rate ~ overwinter_sea_ice_3yr, correlation = corAR1(form = ~1 | site_id), data = penguin_abundance_filtered)

# Summarize the results
summary(gls_model_1yr)
summary(gls_model_2yr)
summary(gls_model_3yr)

# Visualize the relationships for each lag
ggplot(penguin_abundance_filtered, aes(x = overwinter_sea_ice_1yr, y = growth_rate)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  theme_minimal() +
  labs(title = "Relationship Between Open Water Days (Lag 1 Year) and Penguin Growth Rates",
       x = "Proportion of Open Water Days (Lag 1 Year)",
       y = "Growth Rate")

ggplot(penguin_abundance_filtered, aes(x = overwinter_sea_ice_2yr, y = growth_rate)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  theme_minimal() +
  labs(title = "Relationship Between Open Water Days (Lag 2 Years) and Penguin Growth Rates",
       x = "Proportion of Open Water Days (Lag 2 Years)",
       y = "Growth Rate")

ggplot(penguin_abundance_filtered, aes(x = overwinter_sea_ice_3yr, y = growth_rate)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  theme_minimal() +
  labs(title = "Relationship Between Open Water Days (Lag 3 Years) and Penguin Growth Rates",
       x = "Proportion of Open Water Days (Lag 3 Years)",
       y = "Growth Rate")


```
